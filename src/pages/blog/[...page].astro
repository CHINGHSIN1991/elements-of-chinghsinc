---
// component import
import MainLayout from '../../layouts/MainLayout.astro';
import PostCard from '../../components/blog/PostCard.astro';
import CategorySection from '../../components/blog/CategorySection.astro';
import PopularPosts from '../../components/blog/PopularPosts.astro';
import { slugify } from '../../ts/utils';

// import
import { getCollection, type CollectionEntry } from 'astro:content';

interface BlogPageProps {
  page: {
    data: CollectionEntry<'posts'>[];
    url: {
      prev?: string;
      next?: string;
    };
  };
}

// export
export const prerender = true;

export async function getStaticPaths({ paginate }: { paginate: any}){
  const allPosts = await getCollection('posts', ({ data }) => {
    return !data.draft;
  });
  return paginate(allPosts, {  
    pageSize: 6,
  });
}

const { page } = Astro.props as BlogPageProps;
---

<MainLayout>
  <section 
    class="container mx-auto px-4 py-16"
    aria-label="部落格列表"
  >
    <div class="flex gap-8 max-w-7xl mx-auto">
      <!-- 左側邊欄 -->
      <aside class="w-64 shrink-0 hidden lg:block">
        <div class="sticky-navbar-safe space-y-8">
          <!-- 分類列表 -->
          <CategorySection />

          <!-- 熱門文章 -->
          <PopularPosts limit={5} />
        </div>
      </aside>

      <!-- 主要內容區 -->
      <div class="flex-grow mt-8">
        {page && page?.data?.length > 0 ? (
          <>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              { page.data.map((post) => (
                <PostCard post={post} />
              )) }
            </div>

            {page.url.prev || page.url.next ? (
              <div class="pagination-nav flex justify-center gap-4 mt-12">
                {page.url.prev ? (
                  <a href={page.url.prev} class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors">
                    上一頁
                  </a>
                ) : null}

                {page.url.next ? (
                  <a href={page.url.next} class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors">
                    下一頁
                  </a>
                ) : null}
              </div>
            ) : null}
          </>
        ) : (
          <div class="flex flex-col items-center justify-center py-20 text-text-secondary bg-background-secondary rounded-lg shadow-inner">
            <div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center text-gray-400 mb-4">
              <span class="text-2xl">!</span>
            </div>
            <h2 class="text-2xl font-semibold mb-2">尚無文章</h2>
            <p class="text-center max-w-md mb-8">
              目前尚未有任何文章，請稍後再查看。
            </p>
            <a 
              href={import.meta.env.BASE_URL}
              class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-colors"
            >
              返回首頁
            </a>
          </div>
        )}
      </div>
    </div>
  </section>
</MainLayout>

<style>


  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
